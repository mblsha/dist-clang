import "base.proto";

package dist_clang.proto;

message Universal {
  extensions 1 to 200;
}

message Test {
  required string field1 = 1;
  optional string field2 = 2;
  repeated string field3 = 3;

  extend Universal {
    optional Test test = 1;
  }
}

message Error {
  enum Code {
    OK = 0;
    INCONSEQUENT  = 1;  // Call to read/send method of |Connection| is inconsequent.
    NETWORK       = 2;  // Failed to read/send something from network connection.
    BAD_MESSAGE   = 3;  // Incoming/outgoing message is malformed.
    EMPTY_MESSAGE = 4;  // Provided |message| pointer for |Read()| is null.
    EXECUTION     = 5;  // Execution failed.
    OVERLOAD      = 6;  // Pool's queue is full.
    NO_VERSION    = 7;  // Compiler of a requested version is missing.
  }

  required Code code = 1 [default=OK];
  optional string description = 2;

  extend Universal {
    optional Error error = 2;
  }
}

message Flags {
  required Compiler compiler  = 1;  // original compiler executable.
  optional string output      = 2;  // "-o" flag and it's param.
  optional string input       = 3;  // relative path in the last argument.
  repeated string other       = 4;  // these flags form hash for a cache.
}

message LocalExecute {
  required string current_dir = 1;
  required Flags cc_flags     = 2;  // Flags to run compilation.
  optional Flags pp_flags     = 3;  // Flags to run preprocessor.

  extend Universal {
    optional LocalExecute local = 3;
  }
}

message RemoteExecute {
  required string pp_source   = 1;
  required Flags cc_flags     = 2;

  extend Universal {
    optional RemoteExecute remote = 4;
  }
}

message RemoteResult {
  required string obj         = 1;

  extend Universal {
    optional RemoteResult result = 5;
  }
}

// Last unused extension index: 6.
